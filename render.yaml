services:
  # Backend API + WebSocket Server
  - type: web
    name: copybot-backend
    env: node
    region: oregon
    plan: starter
    buildCommand: npm install
    startCommand: npm run backend
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 4000
      - key: DATABASE_URL
        sync: false  # REQUIRED: Set in Render dashboard - Neon Postgres connection string
      - key: ENCRYPTION_KEY
        sync: false  # REQUIRED: 64 hex chars - generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
      - key: JWT_SECRET
        generateValue: true  # Auto-generate secure secret
      - key: FRONTEND_URL
        sync: false  # Set to your frontend URL (e.g., https://copybot-frontend.onrender.com)
      - key: PRIVATE_KEY
        sync: false  # Optional: Set if you want auto-derive on startup
      - key: POLYMARKET_API_KEY
        sync: false  # Optional: Or derive via UI
      - key: POLYMARKET_API_SECRET
        sync: false  # Optional: Or derive via UI
      - key: TARGET_WALLETS
        sync: false  # Optional: Managed via UI per user
      - key: COPY_RATIO
        value: 0.1
      - key: MAX_POSITION_SIZE
        value: 100
      - key: MIN_POSITION_SIZE
        value: 1
      - key: SLIPPAGE_TOLERANCE
        value: 0.01
      - key: POLL_INTERVAL
        value: 5000
      - key: SKIP_ONCHAIN_BALANCE_CHECK
        value: true
      - key: PYTH_HERMES_URL
        value: https://hermes.pyth.network
      - key: USE_LIT
        value: false
      - key: AUTO_CREATE_WALLETS
        value: false

  # Frontend (Next.js)
  - type: web
    name: copybot-frontend
    env: node
    region: oregon
    plan: starter
    buildCommand: npm install && npm run build
    startCommand: npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: NEXT_PUBLIC_BACKEND_URL
        sync: false  # REQUIRED: Set to your backend URL (e.g., https://copybot-backend.onrender.com)
      - key: NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID
        value: d1cedaacac6d453d6bfd54d65b52346f

# Database: Use Neon Postgres (external)
# 1. Create database at https://neon.tech (free tier available)
# 2. Copy connection string from Neon dashboard
# 3. Set DATABASE_URL in backend service environment variables on Render
# Format: postgresql://user:password@host.neon.tech/database?sslmode=require
